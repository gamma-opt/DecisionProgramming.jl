<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Used Car Buyer · DecisionProgramming.jl</title><meta name="title" content="Used Car Buyer · DecisionProgramming.jl"/><meta property="og:title" content="Used Car Buyer · DecisionProgramming.jl"/><meta property="twitter:title" content="Used Car Buyer · DecisionProgramming.jl"/><meta name="description" content="Documentation for DecisionProgramming.jl."/><meta property="og:description" content="Documentation for DecisionProgramming.jl."/><meta property="twitter:description" content="Documentation for DecisionProgramming.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="DecisionProgramming.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">DecisionProgramming.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Decision Programming</span><ul><li><a class="tocitem" href="../../decision-programming/influence-diagram/">Influence Diagram</a></li><li><a class="tocitem" href="../../decision-programming/RJT-model/">RJT model</a></li><li><a class="tocitem" href="../../decision-programming/path-based-model/">Path-based model</a></li><li><a class="tocitem" href="../../decision-programming/cvar/">Conditional value-at-risk</a></li><li><a class="tocitem" href="../../decision-programming/analyzing-decision-strategies/">Analyzing Decision Strategies</a></li><li><a class="tocitem" href="../../decision-programming/computational-complexity/">Computational Complexity</a></li></ul></li><li><a class="tocitem" href="../../usage/">Usage</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>Used Car Buyer</a><ul class="internal"><li><a class="tocitem" href="#Description"><span>Description</span></a></li><li><a class="tocitem" href="#Influence-diagram"><span>Influence diagram</span></a></li><li><a class="tocitem" href="#Generating-the-model"><span>Generating the model</span></a></li><li><a class="tocitem" href="#Solving-the-model"><span>Solving the model</span></a></li><li><a class="tocitem" href="#Analyzing-results"><span>Analyzing results</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../pig-breeding/">Pig Breeding</a></li><li><a class="tocitem" href="../n-monitoring/">N-Monitoring</a></li><li><a class="tocitem" href="../contingent-portfolio-programming/">Contingent Portfolio Programming</a></li><li><a class="tocitem" href="../CHD_preventative_care/">CHD preventative care allocation</a></li></ul></li><li><a class="tocitem" href="../../api/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Used Car Buyer</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Used Car Buyer</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/gamma-opt/DecisionProgramming.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/gamma-opt/DecisionProgramming.jl/blob/master/docs/src/examples/used-car-buyer.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Used-Car-Buyer"><a class="docs-heading-anchor" href="#Used-Car-Buyer">Used Car Buyer</a><a id="Used-Car-Buyer-1"></a><a class="docs-heading-anchor-permalink" href="#Used-Car-Buyer" title="Permalink"></a></h1><h2 id="Description"><a class="docs-heading-anchor" href="#Description">Description</a><a id="Description-1"></a><a class="docs-heading-anchor-permalink" href="#Description" title="Permalink"></a></h2><p>To illustrate the basic functionality of Decision Programming, we implement a version of the used car buyer problem in <sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup>. In this problem, Joe is buying a used car. The car&#39;s price is 1000 USD (US dollars), and its value is 1100 USD. Joe&#39;s base profit on the car is thus 100 USD. However, Joe knows that the car is a &quot;lemon&quot;, meaning that it has defects in 6 major systems, with a 20% probability. With the remaining 80% probability, the car is a &quot;peach&quot;, and it has a defect in only one of the systems.</p><p>The repair costs for a peach are only 40 USD, decreasing Joe&#39;s profit to 60  USD. However, the costs for a lemon are 200 USD, resulting in a total loss of 100 USD. We can now formulate an influence diagram of Joe&#39;s initial problem. We present the influence diagram in the figure below. In an influence diagram, circle nodes such as <span>$O$</span> are called <strong>chance nodes</strong>, representing uncertainty. Node <span>$O$</span> is a chance node representing the state of the car, lemon or peach. Square nodes such as <span>$A$</span> are <strong>decision nodes</strong>, representing decisions. Node <span>$A$</span> represents the decision to buy or not to buy the car. The diamond-shaped <strong>value node</strong> <span>$V$</span> denotes the utility calculation in the problem. For Joe, the utility function is the expected monetary value. The arrows or <strong>arcs</strong> show connections between nodes. The two arcs in this diagram point to the value node, meaning that the monetary value depends on the state of the car and the purchase decision.</p><p><img src="../figures/used-car-buyer-1.svg" alt="\\label{used-car-buyer-1}"/></p><p>We can easily determine the optimal strategy for this problem. If Joe decides not to buy the car, his profit is zero. If he buys the car, with 20% probability he loses 100 USD and with an 80% probability he profits 60 USD. Therefore, the expected profit for buying the car is 28 USD, which is higher than the zero profit of not buying. Thus, Joe should buy the car.</p><p>We now add two new features to the problem. A stranger approaches Joe and offers to tell Joe whether the car is a lemon or a peach for 25 USD. Additionally, the car dealer offers a guarantee plan which costs 60 USD and covers 50% of the repair costs. Joe notes that this is not a very good deal, and the dealer includes an anti-lemon feature: if the total repair cost exceeds 100 USD, the guarantee will fully cover the repairs.</p><h2 id="Influence-diagram"><a class="docs-heading-anchor" href="#Influence-diagram">Influence diagram</a><a id="Influence-diagram-1"></a><a class="docs-heading-anchor-permalink" href="#Influence-diagram" title="Permalink"></a></h2><p><img src="../figures/used-car-buyer-2.svg" alt="\\label{used-car-buyer-2}"/></p><p>We present the new influence diagram above. The decision node <span>$T$</span> denotes the decision to accept or decline the stranger&#39;s offer, and <span>$R$</span> is the outcome of the test. We introduce new value nodes <span>$V_1$</span> and <span>$V_2$</span> to represent the testing costs and the base profit from purchasing the car. Additionally, the decision node <span>$A$</span> now can choose to buy with a guarantee.</p><p>We start by defining the influence diagram structure. The nodes, as well as their information sets and states, are defined in the first block. Next, the influence diagram parameters consisting of the probabilities and utilities are defined.</p><pre><code class="language-julia hljs">using JuMP, HiGHS
using DecisionProgramming
diagram = InfluenceDiagram()</code></pre><h3 id="Car&#39;s-state"><a class="docs-heading-anchor" href="#Car&#39;s-state">Car&#39;s state</a><a id="Car&#39;s-state-1"></a><a class="docs-heading-anchor-permalink" href="#Car&#39;s-state" title="Permalink"></a></h3><p>The chance node <span>$O$</span> is defined by its name, its information set <span>$I(O)$</span> and its states <span>$lemon$</span> and <span>$peach$</span>. As seen in the influence diagram, the information set is empty and the node is a root node.</p><pre><code class="language-julia hljs">add_node!(diagram, ChanceNode(&quot;O&quot;, [], [&quot;lemon&quot;, &quot;peach&quot;]))</code></pre><h3 id="Stranger&#39;s-offer-decision"><a class="docs-heading-anchor" href="#Stranger&#39;s-offer-decision">Stranger&#39;s offer decision</a><a id="Stranger&#39;s-offer-decision-1"></a><a class="docs-heading-anchor-permalink" href="#Stranger&#39;s-offer-decision" title="Permalink"></a></h3><p>A decision node is also defined by its name, its information set and its states.</p><pre><code class="language-julia hljs">add_node!(diagram, DecisionNode(&quot;T&quot;, [], [&quot;no test&quot;, &quot;test&quot;]))</code></pre><h3 id="Test&#39;s-outcome"><a class="docs-heading-anchor" href="#Test&#39;s-outcome">Test&#39;s outcome</a><a id="Test&#39;s-outcome-1"></a><a class="docs-heading-anchor-permalink" href="#Test&#39;s-outcome" title="Permalink"></a></h3><p>The second chance node <span>$R$</span> has nodes <span>$O$</span> and <span>$T$</span> in its information set, and three states describing the situations of no test being done, and the test declaring the car to be a lemon or a peach.</p><pre><code class="language-julia hljs">add_node!(diagram, ChanceNode(&quot;R&quot;, [&quot;O&quot;, &quot;T&quot;], [&quot;no test&quot;, &quot;lemon&quot;, &quot;peach&quot;]))</code></pre><h3 id="Purchase-decision"><a class="docs-heading-anchor" href="#Purchase-decision">Purchase decision</a><a id="Purchase-decision-1"></a><a class="docs-heading-anchor-permalink" href="#Purchase-decision" title="Permalink"></a></h3><p>The purchase decision represented by node <span>$A$</span> is added as follows.</p><pre><code class="language-julia hljs">add_node!(diagram, DecisionNode(&quot;A&quot;, [&quot;R&quot;], [&quot;buy without guarantee&quot;, &quot;buy with guarantee&quot;, &quot;don&#39;t buy&quot;]))</code></pre><h3 id="Testing-fee,-base-profit-and-repair-costs"><a class="docs-heading-anchor" href="#Testing-fee,-base-profit-and-repair-costs">Testing fee, base profit and repair costs</a><a id="Testing-fee,-base-profit-and-repair-costs-1"></a><a class="docs-heading-anchor-permalink" href="#Testing-fee,-base-profit-and-repair-costs" title="Permalink"></a></h3><p>Value nodes are defined by only their names and information sets because they do not have states. Instead, value nodes map their information states to utility values which will be added later on.</p><pre><code class="language-julia hljs">add_node!(diagram, ValueNode(&quot;V1&quot;, [&quot;T&quot;]))
add_node!(diagram, ValueNode(&quot;V2&quot;, [&quot;A&quot;]))
add_node!(diagram, ValueNode(&quot;V3&quot;, [&quot;O&quot;, &quot;A&quot;]))</code></pre><h3 id="Generate-arcs"><a class="docs-heading-anchor" href="#Generate-arcs">Generate arcs</a><a id="Generate-arcs-1"></a><a class="docs-heading-anchor-permalink" href="#Generate-arcs" title="Permalink"></a></h3><p>Now that all of the nodes have been added to our influence diagram we generate the arcs between the nodes. This step automatically orders the nodes, gives them indices and reorganises the information into the appropriate form in the influence diagram structure.</p><pre><code class="language-julia hljs">generate_arcs!(diagram)</code></pre><h3 id="Probabilities"><a class="docs-heading-anchor" href="#Probabilities">Probabilities</a><a id="Probabilities-1"></a><a class="docs-heading-anchor-permalink" href="#Probabilities" title="Permalink"></a></h3><p>We continue by defining probability distributions for each chance node.</p><p>Node <span>$O$</span> is a root node and has two states thus, its probability distribution is simply defined over the two states. We can use the <code>ProbabilityMatrix</code> structure in creating the probability matrix easily without having to worry about the matrix dimensions. We then set the probability values and add the probabililty matrix to the influence diagram.</p><pre><code class="language-julia hljs">X_O = ProbabilityMatrix(diagram, &quot;O&quot;)
X_O[&quot;peach&quot;] = 0.8
X_O[&quot;lemon&quot;] = 0.2
add_probabilities!(diagram, &quot;O&quot;, X_O)</code></pre><p>Node <span>$R$</span> has two nodes in its information set and three states. The probabilities <span>$P(s_j \mid s_{I(j)})$</span> must thus be defined for all combinations of states in <span>$O$</span>, <span>$T$</span> and <span>$R$</span>. We declare the probability distribution over the states of node <span>$R$</span> for each information state in the following way. More information on defining probability matrices can be found on the <a href="../../usage/">usage page</a>.</p><pre><code class="language-julia hljs">X_R = ProbabilityMatrix(diagram, &quot;R&quot;)
X_R[&quot;lemon&quot;, &quot;no test&quot;, :] = [1,0,0]
X_R[&quot;lemon&quot;, &quot;test&quot;, :] = [0,1,0]
X_R[&quot;peach&quot;, &quot;no test&quot;, :] = [1,0,0]
X_R[&quot;peach&quot;, &quot;test&quot;, :] = [0,0,1]
add_probabilities!(diagram, &quot;R&quot;, X_R)</code></pre><h3 id="Utilities"><a class="docs-heading-anchor" href="#Utilities">Utilities</a><a id="Utilities-1"></a><a class="docs-heading-anchor-permalink" href="#Utilities" title="Permalink"></a></h3><p>We continue by defining the utilities associated with the information states of the value nodes. The utilities <span>$Y_j(𝐬_{I(j)})$</span> are defined and added similarly to the probabilities.</p><p>Value node <span>$V1$</span> has only node <span>$T$</span> in its information set and node <span>$T$</span> only has two states. Therefore, the utility matrix of node <span>$V1$</span> should hold utility values corresponding to states <span>$test$</span> and <span>$no \ test$</span>.</p><pre><code class="language-julia hljs">Y_V1 = UtilityMatrix(diagram, &quot;V1&quot;)
Y_V1[&quot;test&quot;] = -25
Y_V1[&quot;no test&quot;] = 0
add_utilities!(diagram, &quot;V1&quot;, Y_V1)</code></pre><p>We then define the utilities associated with the base profit of the purchase in different scenarios.</p><pre><code class="language-julia hljs">Y_V2 = UtilityMatrix(diagram, &quot;V2&quot;)
Y_V2[&quot;buy without guarantee&quot;] = 100
Y_V2[&quot;buy with guarantee&quot;] = 40
Y_V2[&quot;don&#39;t buy&quot;] = 0
add_utilities!(diagram, &quot;V2&quot;, Y_V2)</code></pre><p>Finally, we define the utilities corresponding to the repair costs. The rows of the utilities matrix <code>Y_V3</code> correspond to the state of the car, while the columns correspond to the decision made in node <span>$A$</span>. Notice that the utility values for the second row are added as a vector, in this case it is important to give the utility values in the correct order. The order of the columns is determined by the order in which the states are given when declaring node <span>$A$</span>. See the <a href="../../usage/">usage page</a> for more information on the syntax.</p><pre><code class="language-julia hljs">Y_V3 = UtilityMatrix(diagram, &quot;V3&quot;)
Y_V3[&quot;lemon&quot;, &quot;buy without guarantee&quot;] = -200
Y_V3[&quot;lemon&quot;, &quot;buy with guarantee&quot;] = 0
Y_V3[&quot;lemon&quot;, &quot;don&#39;t buy&quot;] = 0
Y_V3[&quot;peach&quot;, :] = [-40, -20, 0]
add_utilities!(diagram, &quot;V3&quot;, Y_V3)</code></pre><h2 id="Generating-the-model"><a class="docs-heading-anchor" href="#Generating-the-model">Generating the model</a><a id="Generating-the-model-1"></a><a class="docs-heading-anchor-permalink" href="#Generating-the-model" title="Permalink"></a></h2><p>Next we generate the decision model using RJT formulation.</p><pre><code class="language-julia hljs">model, z, variables = generate_model(diagram, model_type=&quot;RJT&quot;)</code></pre><h2 id="Solving-the-model"><a class="docs-heading-anchor" href="#Solving-the-model">Solving the model</a><a id="Solving-the-model-1"></a><a class="docs-heading-anchor-permalink" href="#Solving-the-model" title="Permalink"></a></h2><p>We set up the solver and optimize:</p><pre><code class="language-julia hljs">optimizer = optimizer_with_attributes(
    () -&gt; HiGHS.Optimizer()
)
set_optimizer(model, optimizer)
optimize!(model)</code></pre><h2 id="Analyzing-results"><a class="docs-heading-anchor" href="#Analyzing-results">Analyzing results</a><a id="Analyzing-results-1"></a><a class="docs-heading-anchor-permalink" href="#Analyzing-results" title="Permalink"></a></h2><p>Once the model is solved, we extract the results.</p><pre><code class="language-julia hljs">Z = DecisionStrategy(diagram, z)
S_probabilities = StateProbabilities(diagram, Z)
U_distribution = UtilityDistribution(diagram, Z)</code></pre><h3 id="Decision-strategy"><a class="docs-heading-anchor" href="#Decision-strategy">Decision strategy</a><a id="Decision-strategy-1"></a><a class="docs-heading-anchor-permalink" href="#Decision-strategy" title="Permalink"></a></h3><p>We obtain the following optimal decision strategy:</p><pre><code class="language-julia-repl hljs">julia&gt; print_decision_strategy(diagram, Z, S_probabilities)
┌───────────────┐
│ Decision in T │
├───────────────┤
│ test          │
└───────────────┘
┌───────────────┬───────────────────────┐
│ State(s) of R │ Decision in A         │
├───────────────┼───────────────────────┤
│ lemon         │ buy with guarantee    │
│ peach         │ buy without guarantee │
└───────────────┴───────────────────────┘</code></pre><h3 id="Utility-distribution"><a class="docs-heading-anchor" href="#Utility-distribution">Utility distribution</a><a id="Utility-distribution-1"></a><a class="docs-heading-anchor-permalink" href="#Utility-distribution" title="Permalink"></a></h3><pre><code class="language-julia-repl hljs">julia&gt; print_utility_distribution(U_distribution)
┌───────────┬─────────────┐
│   Utility │ Probability │
│   Float64 │     Float64 │
├───────────┼─────────────┤
│ 15.000000 │    0.200000 │
│ 35.000000 │    0.800000 │
└───────────┴─────────────┘</code></pre><p>From the utility distribution, we can see that Joe&#39;s profit with this strategy is 15 USD, with a 20% probability (the car is a lemon) and 35 USD with an 80% probability (the car is a peach).</p><pre><code class="language-julia-repl hljs">julia&gt; print_statistics(U_distribution)
┌──────────┬────────────┐
│     Name │ Statistics │
│   String │    Float64 │
├──────────┼────────────┤
│     Mean │  31.000000 │
│      Std │   8.000000 │
│ Skewness │  -1.500000 │
│ Kurtosis │   0.250000 │
└──────────┴────────────┘</code></pre><p>The expected profit is thus 31 USD.</p><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>Howard, R. A. (1977). The used car buyer. Reading in Decision Analysis, 2nd Ed. Stanford Research Institute, Menlo Park, CA.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../usage/">« Usage</a><a class="docs-footer-nextpage" href="../pig-breeding/">Pig Breeding »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.6.0 on <span class="colophon-date" title="Monday 2 September 2024 06:18">Monday 2 September 2024</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
