<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Contingent Portfolio Programming · DecisionProgramming.jl</title><meta name="title" content="Contingent Portfolio Programming · DecisionProgramming.jl"/><meta property="og:title" content="Contingent Portfolio Programming · DecisionProgramming.jl"/><meta property="twitter:title" content="Contingent Portfolio Programming · DecisionProgramming.jl"/><meta name="description" content="Documentation for DecisionProgramming.jl."/><meta property="og:description" content="Documentation for DecisionProgramming.jl."/><meta property="twitter:description" content="Documentation for DecisionProgramming.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="DecisionProgramming.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">DecisionProgramming.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Decision Programming</span><ul><li><a class="tocitem" href="../../decision-programming/influence-diagram/">Influence Diagram</a></li><li><a class="tocitem" href="../../decision-programming/RJT-model/">RJT model</a></li><li><a class="tocitem" href="../../decision-programming/path-based-model/">Path-based model</a></li><li><a class="tocitem" href="../../decision-programming/cvar/">Conditional value-at-risk</a></li><li><a class="tocitem" href="../../decision-programming/analyzing-decision-strategies/">Analyzing Decision Strategies</a></li><li><a class="tocitem" href="../../decision-programming/computational-complexity/">Computational Complexity</a></li></ul></li><li><a class="tocitem" href="../../usage/">Usage</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../used-car-buyer/">Used Car Buyer</a></li><li><a class="tocitem" href="../pig-breeding/">Pig Breeding</a></li><li><a class="tocitem" href="../n-monitoring/">N-Monitoring</a></li><li class="is-active"><a class="tocitem" href>Contingent Portfolio Programming</a><ul class="internal"><li><a class="tocitem" href="#Description"><span>Description</span></a></li><li><a class="tocitem" href="#Influence-Diagram:-Projects"><span>Influence Diagram: Projects</span></a></li><li><a class="tocitem" href="#Analyzing-results"><span>Analyzing results</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../CHD_preventative_care/">CHD preventative care allocation</a></li></ul></li><li><a class="tocitem" href="../../api/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Contingent Portfolio Programming</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Contingent Portfolio Programming</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/gamma-opt/DecisionProgramming.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/gamma-opt/DecisionProgramming.jl/blob/master/docs/src/examples/contingent-portfolio-programming.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Contingent-Portfolio-Programming"><a class="docs-heading-anchor" href="#Contingent-Portfolio-Programming">Contingent Portfolio Programming</a><a id="Contingent-Portfolio-Programming-1"></a><a class="docs-heading-anchor-permalink" href="#Contingent-Portfolio-Programming" title="Permalink"></a></h1><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>This example discusses adding constraints and decision variables to the Decision Programming formulation, as well as custom path utility calculation. Because of this, it is quite advanced compared to the earlier ones. </p></div></div><h2 id="Description"><a class="docs-heading-anchor" href="#Description">Description</a><a id="Description-1"></a><a class="docs-heading-anchor-permalink" href="#Description" title="Permalink"></a></h2><p><sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup>, section 4.2</p><blockquote><p>For instance, assume that the first-stage decisions specify which technology development projects will be started to generate patent-based intellectual property ( P ) for a platform. This intellectual property contributes subject to some uncertainties to the technical competitiveness ( T ) of the platform. In the second stage, it is possible to carry out application ( A ) development projects which, when completed, yield cash flows that depend on the market share of the platform. This market share ( M ) depends on the competitiveness of the platform and the number of developed applications. The aim is to maximize the cash flows from application projects less the cost of technology and application development projects.</p></blockquote><h2 id="Influence-Diagram:-Projects"><a class="docs-heading-anchor" href="#Influence-Diagram:-Projects">Influence Diagram: Projects</a><a id="Influence-Diagram:-Projects-1"></a><a class="docs-heading-anchor-permalink" href="#Influence-Diagram:-Projects" title="Permalink"></a></h2><p><img src="../figures/contingent-portfolio-programming.svg" alt/></p><p>The influence diagram of the contingent portfolio programming (CPP) problem.</p><p>There are <span>$n_T$</span> technology development projects and <span>$n_A$</span> application development projects.</p><p>Decision states to develop patents</p><p class="math-container">\[d_i^P∈D_i^P=\{[q_1^P, q_2^P), [q_2^P, q_3^P), ..., [q_{|D^P|}^P, q_{|D^P|+1}^P)\}\]</p><p>Chance states of technical competitiveness <span>$c_j^T∈C_j^T$</span></p><p>Decision states to develop applications</p><p class="math-container">\[d_k^A∈D^A=\{[q_1^A, q_2^A), [q_2^A, q_3^A), ..., [q_{|D^A|}^A, q_{|D^A|+1}^A)\}\]</p><p>Chance states of market size <span>$c_l^M∈C_l^M$</span></p><pre><code class="language-julia hljs">using Random
using JuMP, HiGHS
using DecisionProgramming

Random.seed!(42)

diagram = InfluenceDiagram()

add_node!(diagram, DecisionNode(&quot;DP&quot;, [], [&quot;0-3 patents&quot;, &quot;3-6 patents&quot;, &quot;6-9 patents&quot;]))
add_node!(diagram, ChanceNode(&quot;CT&quot;, [&quot;DP&quot;], [&quot;low&quot;, &quot;medium&quot;, &quot;high&quot;]))
add_node!(diagram, DecisionNode(&quot;DA&quot;, [&quot;DP&quot;, &quot;CT&quot;], [&quot;0-5 applications&quot;, &quot;5-10 applications&quot;, &quot;10-15 applications&quot;]))
add_node!(diagram, ChanceNode(&quot;CM&quot;, [&quot;CT&quot;, &quot;DA&quot;], [&quot;low&quot;, &quot;medium&quot;, &quot;high&quot;]))

generate_arcs!(diagram)</code></pre><h3 id="Technical-competitiveness-probability"><a class="docs-heading-anchor" href="#Technical-competitiveness-probability">Technical competitiveness probability</a><a id="Technical-competitiveness-probability-1"></a><a class="docs-heading-anchor-permalink" href="#Technical-competitiveness-probability" title="Permalink"></a></h3><p>Probability of technical competitiveness <span>$c_j^T$</span> given the range <span>$d_i^P$</span>: <span>$ℙ(c_j^T∣d_i^P)∈[0,1]$</span>. A high number of patents increases probability of high competitiveness and a low number correspondingly increases the probability of low competitiveness.</p><pre><code class="language-julia hljs">X_CT = ProbabilityMatrix(diagram, &quot;CT&quot;)
X_CT[1, :] = [1/2, 1/3, 1/6]
X_CT[2, :] = [1/3, 1/3, 1/3]
X_CT[3, :] = [1/6, 1/3, 1/2]
add_probabilities!(diagram, &quot;CT&quot;, X_CT)</code></pre><h3 id="Market-share-probability"><a class="docs-heading-anchor" href="#Market-share-probability">Market share probability</a><a id="Market-share-probability-1"></a><a class="docs-heading-anchor-permalink" href="#Market-share-probability" title="Permalink"></a></h3><p>Probability of market share <span>$c_l^M$</span> given the technical competitiveness <span>$c_j^T$</span> and range <span>$d_k^A$</span>: <span>$ℙ(c_l^M∣c_j^T,d_k^A)∈[0,1]$</span>. Higher competitiveness and number of application projects both increase the probability of high market share.</p><pre><code class="language-julia hljs">X_CM = ProbabilityMatrix(diagram, &quot;CM&quot;)
X_CM[1, 1, :] = [2/3, 1/4, 1/12]
X_CM[1, 2, :] = [1/2, 1/3, 1/6]
X_CM[1, 3, :] = [1/3, 1/3, 1/3]
X_CM[2, 1, :] = [1/2, 1/3, 1/6]
X_CM[2, 2, :] = [1/3, 1/3, 1/3]
X_CM[2, 3, :] = [1/6, 1/3, 1/2]
X_CM[3, 1, :] = [1/3, 1/3, 1/3]
X_CM[3, 2, :] = [1/6, 1/3, 1/2]
X_CM[3, 3, :] = [1/12, 1/4, 2/3]
add_probabilities!(diagram, &quot;CM&quot;, X_CM)</code></pre><h3 id="Generating-the-model"><a class="docs-heading-anchor" href="#Generating-the-model">Generating the model</a><a id="Generating-the-model-1"></a><a class="docs-heading-anchor-permalink" href="#Generating-the-model" title="Permalink"></a></h3><p>We generate the RJT model:</p><pre><code class="language-julia hljs">model, z, μ_s = generate_model(diagram, model_type=&quot;RJT&quot;)</code></pre><h3 id="Creating-problem-specific-variables"><a class="docs-heading-anchor" href="#Creating-problem-specific-variables">Creating problem specific variables</a><a id="Creating-problem-specific-variables-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-problem-specific-variables" title="Permalink"></a></h3><p>We recommend reading Section 4.2. in <sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup> for motivation and details of the formulation.</p><p>Technology project <span>$t$</span> costs <span>$I_t∈ℝ^+$</span> and generates <span>$O_t∈ℕ$</span> patents.</p><p>Application project <span>$a$</span> costs <span>$I_a∈ℝ^+$</span> and generates <span>$O_a∈ℕ$</span> applications. If completed, provides cash flow <span>$V(a|c_l^M)∈ℝ^+.$</span></p><pre><code class="language-julia hljs">
# Number of states in each node
n_DP = num_states(diagram, &quot;DP&quot;)
n_CT = num_states(diagram, &quot;CT&quot;)
n_DA = num_states(diagram, &quot;DA&quot;)
n_CM = num_states(diagram, &quot;CM&quot;)

n_T = 5                     # number of technology projects
n_A = 5                     # number of application projects
I_t = rand(n_T)*0.1         # costs of technology projects
O_t = rand(1:3,n_T)         # number of patents for each tech project
I_a = rand(n_T)*2           # costs of application projects
O_a = rand(2:4,n_T)         # number of applications for each appl. project

V_A = rand(n_CM, n_A).+0.5 # Value of an application
V_A[1, :] .+= -0.5          # Low market share: less value
V_A[3, :] .+= 0.5           # High market share: more value</code></pre><p>Decision variables <span>$x^T(t)∈\{0, 1\}$</span> indicate which technologies are selected.</p><p>Decision variables <span>$x^A(a∣d_i^P,c_j^T)∈\{0, 1\}$</span> indicate which applications are selected.</p><pre><code class="language-julia hljs">function model_variables(model::Model, dims::AbstractVector{Int}; binary::Bool=false)
    v = Array{VariableRef}(undef, dims...)
    for i in eachindex(v)
        v[i] = @variable(model, binary=binary)
    end
    return v
end

x_T = model_variables(model, [n_DP, n_T]; binary=true)
x_A = model_variables(model, [n_DP, n_CT, n_DA, n_A]; binary=true)</code></pre><p>Number of patents <span>$x^T(t) = ∑_i x_i^T(t) z(d_i^P)$</span></p><p>Number of applications <span>$x^A(a∣d_i^P,c_j^T) = ∑_k x_k^A(a∣d_i^P,c_j^T) z(d_k^A|d_i^P,c_j^T)$</span></p><p>Helpful variables:</p><p>Large constant <span>$M$</span> (e.g. <span>$\frac{3}{2}\text{max}\{\sum_t O_t,\sum_a O_a\}$</span>)</p><p>Small constant <span>$\varepsilon$</span> = <span>$\frac{1}{2}\text{min}\{O_t, O_a\}$</span></p><pre><code class="language-julia hljs">M = 20                      # a large constant
ε = 0.5*minimum([O_t O_a])  # a helper variable, allows using ≤ instead of &lt; in constraints (28b) and (29b)</code></pre><p>Limits <span>$q_i^P$</span> and <span>$q_k^A$</span> of the intervals</p><pre><code class="language-julia hljs">q_P = [0, 3, 6, 9]          # limits of the technology intervals
q_A = [0, 5, 10, 15]        # limits of the application intervals</code></pre><p>Shorthand for the decision variables <span>$z$</span></p><pre><code class="language-julia hljs">z_dP = z[&quot;DP&quot;].z
z_dA = z[&quot;DA&quot;].z</code></pre><h3 id="Creating-problem-specific-constraints"><a class="docs-heading-anchor" href="#Creating-problem-specific-constraints">Creating problem specific constraints</a><a id="Creating-problem-specific-constraints-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-problem-specific-constraints" title="Permalink"></a></h3><p class="math-container">\[∑_t x_i^T(t) \le z(d_i^P)n_T, \quad \forall i\]</p><pre><code class="language-julia hljs">@constraint(model, [i=1:n_DP],
    sum(x_T[i,t] for t in 1:n_T) &lt;= z_dP[i]*n_T)</code></pre><p class="math-container">\[∑_a x_k^A(a∣d_i^P,c_j^T) \le z(d_i^P)n_A, \quad \forall i,j,k\]</p><pre><code class="language-julia hljs">@constraint(model, [i=1:n_DP, j=1:n_CT, k=1:n_DA],
    sum(x_A[i,j,k,a] for a in 1:n_A) &lt;= z_dP[i]*n_A)</code></pre><p class="math-container">\[∑_a x_k^A(a∣d_i^P,c_j^T) \le z(d_k^A|d_i^P,c_j^T)n_A, \quad \forall i,j,k\]</p><pre><code class="language-julia hljs">@constraint(model, [i=1:n_DP, j=1:n_CT, k=1:n_DA],
    sum(x_A[i,j,k,a] for a in 1:n_A) &lt;= z_dA[i,j,k]*n_A)</code></pre><p class="math-container">\[q_i^P - (1-z(d_i^P))M \le \sum_t x_i^T(t)O_t \le q_{i+1}^P + (1-z(d_i^P))M - \varepsilon, \quad \forall i\]</p><pre><code class="language-julia hljs">@constraint(model, [i=1:n_DP],
    q_P[i] - (1 - z_dP[i])*M &lt;= sum(x_T[i,t]*O_t[t] for t in 1:n_T))
@constraint(model, [i=1:n_DP],
    sum(x_T[i,t]*O_t[t] for t in 1:n_T) &lt;= q_P[i+1] + (1 - z_dP[i])*M - ε)
</code></pre><p class="math-container">\[q_k^A - (1-z(d_k^A|d_i^P,c_j^T))M \le \sum_a x_k^A(a∣d_i^P,c_j^T)O_a \le q_{k+1}^A + (1-z(d_k^A|d_i^P,c_j^T))M - \varepsilon, \quad \forall i,j,k\]</p><pre><code class="language-julia hljs">@constraint(model, [i=1:n_DP, j=1:n_CT, k=1:n_DA],
    q_A[k] - (1 - z_dA[i,j,k])*M &lt;= sum(x_A[i,j,k,a]*O_a[a] for a in 1:n_A))
@constraint(model, [i=1:n_DP, j=1:n_CT, k=1:n_DA],
    sum(x_A[i,j,k,a]*O_a[a] for a in 1:n_A) &lt;= q_A[k+1] + (1 - z_dA[i,j,k])*M - ε)</code></pre><p>We can also model dependencies between the technology and application projects, e.g. application project <span>$a$</span> can be completed only if technology project <span>$t$</span> has been completed. This is done by adding constraints</p><p class="math-container">\[x_k^A(a∣d_i^P,c_j^T) \le x_i^T(t), \quad \forall i,j,k\]</p><p>As an example, we state that application projects 1 and 2 require technology project 1, and application project 2 also requires technology project 2.</p><pre><code class="language-julia hljs">@constraint(model, [i=1:n_DP, j=1:n_CT, k=1:n_DA], x_A[i,j,k,1] &lt;= x_T[i,1])
@constraint(model, [i=1:n_DP, j=1:n_CT, k=1:n_DA], x_A[i,j,k,2] &lt;= x_T[i,1])
@constraint(model, [i=1:n_DP, j=1:n_CT, k=1:n_DA], x_A[i,j,k,2] &lt;= x_T[i,2])</code></pre><p class="math-container">\[x_i^T(t)∈\{0, 1\}, \quad \forall i\]</p><p class="math-container">\[x_k^A(a∣d_i^P,c_j^T)∈\{0, 1\}, \quad \forall i,j,k\]</p><h3 id="Objective-function"><a class="docs-heading-anchor" href="#Objective-function">Objective function</a><a id="Objective-function-1"></a><a class="docs-heading-anchor-permalink" href="#Objective-function" title="Permalink"></a></h3><p>The path utility can be calculated as <span>$\mathcal{U}(s) = \sum_a x_k^A(a∣d_i^P,c_j^T) (V(a|c_l^M) - I_a) - ∑_t x_i^T(t) I_t$</span></p><p>However, using the expected value objective would lead to a quadratic objective function as the path utility formulation now contains decision variables. In order to keep the problem completely linear, we can use the objective formulation presented in <sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup>:</p><p class="math-container">\[\sum_i \left\{ \sum_{j,k,l} p(c_j^T \mid d_i^P) p(c_l^M \mid c_j^T, d_k^A) \left[\sum_a x_k^A(a \mid d_i^P,c_j^T) (V(a \mid c_l^M) - I_a)\right] - \sum_t x_i^T(t) I_t \right\}\]</p><pre><code class="language-julia hljs">patent_investment_cost = @expression(model, [i=1:n_DP], sum(x_T[i, t] * I_t[t] for t in 1:n_T))
application_investment_cost = @expression(model, [i=1:n_DP, j=1:n_CT, k=1:n_DA], sum(x_A[i, j, k, a] * I_a[a] for a in 1:n_A))
application_value = @expression(model, [i=1:n_DP, j=1:n_CT, k=1:n_DA, l=1:n_CM], sum(x_A[i, j, k, a] * V_A[l, a] for a in 1:n_A))
@objective(model, Max, sum( sum( diagram.P(convert.(State, (i,j,k,l))) * (application_value[i,j,k,l] - application_investment_cost[i,j,k]) for j in 1:n_CT, k in 1:n_DA, l in 1:n_CM ) - patent_investment_cost[i] for i in 1:n_DP ))

</code></pre><h3 id="Solving-the-Model"><a class="docs-heading-anchor" href="#Solving-the-Model">Solving the Model</a><a id="Solving-the-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Solving-the-Model" title="Permalink"></a></h3><pre><code class="language-julia hljs">optimizer = optimizer_with_attributes(
    () -&gt; HiGHS.Optimizer()
)
set_optimizer(model, optimizer)
optimize!(model)</code></pre><h2 id="Analyzing-results"><a class="docs-heading-anchor" href="#Analyzing-results">Analyzing results</a><a id="Analyzing-results-1"></a><a class="docs-heading-anchor-permalink" href="#Analyzing-results" title="Permalink"></a></h2><p>The optimal decision strategy and the utility distribution are printed. The strategy is to make 6-9 patents (state 3 in node 1) and 10-15 applications. The expected utility for this strategy is 1.08. Julia version 1.10.3 was used in random number generation (the version used might affect the results).</p><pre><code class="language-julia hljs">Z = DecisionStrategy(diagram, z)
S_probabilities = StateProbabilities(diagram, Z)</code></pre><pre><code class="language-julia-repl hljs">julia&gt; print_decision_strategy(diagram, Z, S_probabilities)
┌────────────────┐
│ Decision in DP │
├────────────────┤
│ 6-9 patents    │
└────────────────┘
┌─────────────────────┬────────────────────┐
│ State(s) of DP, CT  │ Decision in DA     │
├─────────────────────┼────────────────────┤
│ 6-9 patents, low    │ 10-15 applications │
│ 6-9 patents, medium │ 10-15 applications │
│ 6-9 patents, high   │ 10-15 applications │
└─────────────────────┴────────────────────┘</code></pre><p>We use a custom path utility function to obtain the utility distribution.</p><pre><code class="language-julia hljs">struct PathUtility &lt;: AbstractPathUtility
    data::Array{AffExpr}
end
Base.getindex(U::PathUtility, i::State) = getindex(U.data, i)
Base.getindex(U::PathUtility, I::Vararg{State,N}) where N = getindex(U.data, I...)
(U::PathUtility)(s::Path) = value.(U[s...])

path_utility = [@expression(model,
    sum(x_A[s[diagram.Nodes[&quot;DP&quot;].index], s[diagram.Nodes[&quot;CT&quot;].index], s[diagram.Nodes[&quot;DA&quot;].index], a] * (V_A[s[diagram.Nodes[&quot;CM&quot;].index], a] - I_a[a]) for a in 1:n_A) -
    sum(x_T[s[diagram.Nodes[&quot;DP&quot;].index], t] * I_t[t] for t in 1:n_T)) for s in paths(get_values(diagram.S))]
diagram.U = PathUtility(path_utility)</code></pre><pre><code class="language-julia hljs">U_distribution = UtilityDistribution(diagram, Z)</code></pre><pre><code class="language-julia-repl hljs">julia&gt; print_utility_distribution(U_distribution)
┌───────────┬─────────────┐
│   Utility │ Probability │
│   Float64 │     Float64 │
├───────────┼─────────────┤
│ -2.338179 │    0.152778 │
│ -0.130143 │    0.291667 │
│  2.650091 │    0.555556 │
└───────────┴─────────────┘</code></pre><pre><code class="language-julia-repl hljs">julia&gt; print_statistics(U_distribution)
┌──────────┬────────────┐
│     Name │ Statistics │
│   String │    Float64 │
├──────────┼────────────┤
│     Mean │   1.077093 │
│      Std │   1.892543 │
│ Skewness │  -0.654557 │
│ Kurtosis │  -1.066341 │
└──────────┴────────────┘</code></pre><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>Salo, A., Andelmin, J., &amp; Oliveira, F. (2019). Decision Programming for Multi-Stage Optimization under Uncertainty, 1–35. Retrieved from <a href="http://arxiv.org/abs/1910.09196">http://arxiv.org/abs/1910.09196</a></li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../n-monitoring/">« N-Monitoring</a><a class="docs-footer-nextpage" href="../CHD_preventative_care/">CHD preventative care allocation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.6.0 on <span class="colophon-date" title="Monday 2 September 2024 10:22">Monday 2 September 2024</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
